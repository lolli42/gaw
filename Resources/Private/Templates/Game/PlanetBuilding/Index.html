{namespace gaw=Lolli\Gaw\ViewHelpers}

<f:layout name="Game" />

<f:section name="Title">
	<f:if condition="{selectedPlanet.name}">
		<f:then>
			Ausbau "{selectedPlanet.name}"
		</f:then>
		<f:else>
			Planetenausbau
		</f:else>
	</f:if>
</f:section>

<f:section name="Content">

	<f:comment>
		@TODO: Needs proper implementation
		<f:form action="renamePlanet" object="{selectedPlanet}" objectName="planet">
			<th>Name</th>
			<td><f:form.textfield property="name" id="name" /></td>
			<td><f:form.submit value="Umbenennen" /></td>
		</f:form>
	</f:comment>

	<table>
		<thead>
			<tr>
				<th colspan="3">
					Laufende Bauaufträge
					<f:if condition="{currentStructureBuildQueueLength} >= {settings.Game.Planet.maximumStructureQueueLength}">
						<f:then>
							<span class="entity-not-available">[{currentStructureBuildQueueLength}]</span>
						</f:then>
						<f:else>
							<span class="entity-available">[{currentStructureBuildQueueLength}]</span>
						</f:else>
					</f:if>
				</th>
			</tr>
		</thead>
		<tbody>
			<f:for each="{selectedPlanet.structureBuildQueue}" as="queueItem" iteration="queueIterator">
				<tr>
					<td>
						<f:translate id="planet.{queueItem.name}" />
					</td>
					<td>
						{queueItem.readyTime -> gaw:format.realTime(gameTime: gameTime, realTime: realTime)}
					</td>
					<td>
						<f:if condition="{queueIterator.isLast}">
							<f:form action="removeLastStructureFromBuildQueue" object="{selectedPlanet}" objectName="planet">
								<f:form.submit value="Abbrechen" />
							</f:form>
						</f:if>
					</td>
				</tr>
			</f:for>
		</tbody>
	</table>

	<table>
		<thead>
			<tr>
				<th colspan="2">
					Gebäude
				</th>
			</tr>
		</thead>
		<f:for
			each="{
				0: 'base',
				1: 'ironMine',
				2: 'siliconMine',
				3: 'xenonMine',
				4: 'hydrazineMine',
				5: 'energyMine'
			}"
			as="structureName"
		>
			<f:if condition="{selectedPlanet -> gaw:planet.isStructureAvailable(structureName: structureName)}">
				<tr>
					<td>
						<f:translate id="planet.{structureName}" />
						<span class="entity-available">[{selectedPlanet -> gaw:property(propertyName: structureName)}]</span>
					</td>
					<td>
						<f:if condition="{currentStructureBuildQueueLength} < {settings.Game.Planet.maximumStructureQueueLength}">
							<f:form action="addStructureToBuildQueue" object="{selectedPlanet}" objectName="planet">
								<f:form.hidden value="{structureName}" name="structureName" />
								<f:form.submit value="Ausbauen" />
							</f:form>
						</f:if>
					</td>
				</tr>
			</f:if>
		</f:for>
	</table>

	<table>
		<thead>
			<tr>
				<th colspan="2">
					Techtree
				</th>
			</tr>
		</thead>
		<tbody>
			<f:for each="{structureTechTree}" as="requirements" key="structureName">
				<tr>
					<td>
						<f:translate id="planet.{structureName}" />
					</td>
					<td>
						<ul class="no-bullet no-margin-bottom">
							<f:for each="{requirements}" as="level" key="requirement">
								<f:if condition="{selectedPlanet -> gaw:property(propertyName: requirement)} < {level}">
								<f:then>
									<li>
										<f:translate id="planet.{requirement}" />
										<span class="entity-not-available">[{level}]</span>
										<span class="entity-available">[{selectedPlanet -> gaw:property(propertyName: requirement)}]</span>
									</li>
								</f:then>
								<f:else>
									<li>
										<f:translate id="planet.{requirement}" />
										<span class="entity-available">[{level}]</span>
									</li>
								</f:else>
							</f:if>
						</f:for>
						</ul>
					</td>
				</tr>
			</f:for>
		</tbody>
	</table>

	<table>
		<thead>
			<tr>
				<th colspan="3">
					Planetenpunkte
				</th>
			</tr>
		</thead>
		<tbody>
			<f:for each="{pointsByStructure}" as="points" key="structureName">
				<tr>
					<td>
						<f:translate id="planet.{structureName}" />
					</td>
					<td>
						{points}
					</td>
					<td>
						<gaw:math.multiply
							factorOne="{selectedPlanet -> gaw:property(propertyName: structureName)}"
							factorTwo="{points}"
						/>
					</td>
				</tr>
			</f:for>
			<tr>
				<td colspan="2">
					Summe
				</td>
				<td>
					{selectedPlanet.points}
				</td>
			</tr>
		</tbody>
	</table>
</f:section>